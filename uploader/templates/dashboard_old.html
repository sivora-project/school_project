{% extends "base.html" %}
{% block content %}

<h2>ğŸ« School Attendance Dashboard</h2>

<form method="get" action="{% url 'school_dashboard' %}">
    <label>Month:</label>
    <select name="month">
        {% for m in "123456789101112"|make_list %}
            <option value="{{ forloop.counter }}"
                {% if selected_month == forloop.counter %}selected{% endif %}>
                {{ forloop.counter }}
            </option>
        {% endfor %}
    </select>

    <label>Academic Year:</label>
    <select name="year">
        <option value="">All</option>
        {% for y in academic_years %}
            <option value="{{ y }}"
                {% if y == selected_year %}selected{% endif %}>
                {{ y }}
            </option>
        {% endfor %}
    </select>

    <button type="submit">Apply</button>
</form>

<hr>

<h3>ğŸ“Š Summary</h3>
<ul>
    <li>Total Students: <b>{{ total_students }}</b></li>
    <li>Present: <b style="color:green">{{ total_present }}</b></li>
    <li>Absent: <b style="color:red">{{ total_absent }}</b></li>
    <li>Attendance %: <b>{{ attendance_percentage }}%</b></li>
</ul>

<hr>

<h3>ğŸš¨ Regular Absentees</h3>
<table border="1" cellpadding="8">
<tr>
    <th>Student ID</th>
    <th>Absent Streak</th>
    <th>Risk Level</th>
</tr>

{% for sid, days in regular_absent_map.items %}
<tr
{% if days >= 4 %}
    style="background:#ffcccc"
{% elif days == 3 %}
    style="background:#ffe0b3"
{% else %}
    style="background:#ffffcc"
{% endif %}
>
    <td>{{ sid }}</td>
    <td>{{ days }} days</td>
    <td>
        {% if days >= 4 %}Critical
        {% elif days == 3 %}High Risk
        {% else %}Warning
        {% endif %}
    </td>
</tr>
{% empty %}
<tr>
    <td colspan="3">No regular absentees</td>
</tr>
{% endfor %}
</table>

<hr>

<h3>ğŸ“ˆ Attendance Trend (Month-wise)</h3>
<canvas id="trendChart" height="120"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
new Chart(document.getElementById('trendChart'), {
    type: 'line',
    data: {
        labels: {{ trend_labels|safe }},
        datasets: [{
            label: 'Attendance %',
            data: {{ trend_data|safe }},
            borderWidth: 2,
            tension: 0.3
        }]
    }
});
</script>

{% endblock %}
